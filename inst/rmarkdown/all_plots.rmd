---
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    number_section: TRUE
params:
  csv: NA
  daily_submission_goal: NA
  svc: NA
  date_col: NA
  exclude_weekend: NA
  delimiter: NA
  text_col: NA
  lang: NA
  lang_wc: NA
  return_table: NA
  title: NA
  author: NA
title: "`r params$title`"
author: "`r params$author`"
date: "`r format(Sys.time(), '%d %B, %Y')`"
---

```{r, include = FALSE, message=FALSE, warning=FALSE}
library(repvisforODK)
library(readr)
library(knitr)
library(htmltools)
```

```{r, include = FALSE, message=FALSE, warning=FALSE}
# general
df <- readr::read_csv(params$csv)
date_col <- params$date_col
daily_submission_goal <- as.numeric(params$daily_submission_goal)
svc <- params$svc

# for question-specific plots
lang <- params$lang

# only for submissions_time series_lineplot
exclude_weekend <- as.logical(params$exclude_weekend)

# only for multiple_choice_question_bar
delimiter <- params$delimiter

# only for word cloud
text_col <- params$text_col
lang_wc <- params$lang_wc
return_table <- params$return_table
```

# Number of Submissions: Received vs. Missing to Target
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
fig <- repvisforODK::submission_goal_donut(df = df, daily_submission_goal = daily_submission_goal, date_col = date_col)
fig
```

# Received Submissions Over Time: Cumulative
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
fig <- repvisforODK::submissions_timeseries_lineplot(df = df, daily_submission_goal = daily_submission_goal, date_col = date_col, exclude_weekend = exclude_weekend, cumulative = TRUE)
fig
```

# Received Submissions Over Time: Non-Cumulative
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
fig <- repvisforODK::submissions_timeseries_lineplot(df = df, daily_submission_goal = daily_submission_goal, date_col = date_col, exclude_weekend = exclude_weekend, cumulative = FALSE)
fig
```

# Submission Activitiy by Weekday and Day of the Week 
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
fig <- repvisforODK::heatmap_wday_hourofday(df = df, date_col = date_col)
fig
```

# Submission Activity by Day 
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
fig <- repvisforODK::heatmap_calendar(df = df, daily_submission_goal = daily_submission_goal, date_col = date_col)
fig
```

# Distribution of Answers for Single-Choice Questions
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
plots <- repvisforODK::single_choice_question_pie(lang = lang)
htmltools::tagList(plots)
```

# Distribution of Answers for Mutiple-Choice Questions
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
plots <- repvisforODK::multiple_choice_question_bar(lang = lang)
htmltools::tagList(plots) 
```

# Wordcloud for Free Text Question
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
wordclouds <- repvisforODK::free_text_wordcloud(text_col = text_col, lang = lang, lang_wc = lang_wc, return_table = return_table)
htmltools::tagList(lapply(wordclouds, print)) 
```

# Frequency Table for Free Text Question
```{r, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
tables <- repvisforODK::free_text_wordcloud(text_col = text_col, lang = lang, lang_wc = lang_wc, return_table = TRUE)
tables[[1]]
```
